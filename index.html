<!DOCTYPE html>
<html lang="es"><head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.13/html-to-image.min.js" integrity="sha512-iZ2ORl595Wx6miw+GuadDet4WQbdSWS3JLMoNfY8cRGoEFy6oT3G9IbcrBeL6AfkgpA51ETt/faX6yLV+/gFJg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
      (function() {
        const originalConsole = window.console;
        window.console = {
          log: (...args) => {
            originalConsole.log(...args);
            window.parent.postMessage({ type: 'console', message: args.join(' ') }, '*');
          },
          error: (...args) => {
            originalConsole.error(...args);
            window.parent.postMessage({ type: 'console', message: 'Error: ' + args.join(' ') }, '*');
          },
          warn: (...args) => {
            originalConsole.warn(...args);
            window.parent.postMessage({ type: 'console', message: 'Warning: ' + args.join(' ') }, '*');
          }
        };

        let requestId = 0;
        let callbacksMap = new Map();
        let streamControllers = new Map();
        
        window.claude = {
          complete: (prompt) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'claudeComplete', id, prompt }, '*');
            });
          }
        };

        window.storage = {
          get: (key, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageGet', id, key, shared }, '*');
            });
          },
          set: (key, value, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageSet', id, key, value, shared }, '*');
            });
          },
          delete: (key, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageDelete', id, key, shared }, '*');
            });
          },
          list: (prefix, shared = false) => {
            return new Promise((resolve, reject) => {
              const id = requestId++;
              callbacksMap.set(id, { resolve, reject });
              window.parent.postMessage({ type: 'storageList', id, prefix, shared }, '*');
            });
          }
        };

        let pendingBlobs = new Map();
        URL.createObjectURL = (blob) => {
          // Store the blob and create an ID and URL for it
          const blobId = `blob-${Date.now()}-${Math.random()}`;
          pendingBlobs.set(blobId, blob);
          return `blob-request://${blobId}`;
        };

        URL.revokeObjectURL = (url) => {
          // Remove the blob from our store
          const blobId = url.replace("blob-request://", "");
          pendingBlobs.delete(blobId);
        };

        const getBlobFromURL = (url) => {
          const blobId = url.replace("blob-request://", "");
          return pendingBlobs.get(blobId);
        };

        // Override global fetch with streaming support
        window.fetch = (url, init = {}) => {
          return new Promise((resolve, reject) => {
            const id = requestId++;
            const channelId = `fetch-${id}-${Date.now()}`;
            
            callbacksMap.set(id, { 
              resolve: (response) => {
                // Create a ReadableStream for the response body
                const stream = new ReadableStream({
                  start(controller) {
                    streamControllers.set(channelId, controller);
                  },
                  cancel() {
                    streamControllers.delete(channelId);
                  }
                });
                
                // Create and return the Response with the stream
                resolve(new Response(stream, {
                  status: response.status,
                  statusText: response.statusText,
                  headers: response.headers
                }));
              },
              reject,
              channelId
            });
            
            window.parent.postMessage({
              type: 'proxyFetch',
              id,
              url,
              init,
              channelId
            }, '*');
          });
        };

        window.addEventListener('message', async (event) => {
          if (event.data.type === 'takeScreenshot') {
            const rootElement = document.getElementById('artifacts-component-root-html');
            if (!rootElement) {
              window.parent.postMessage({
                type: 'screenshotError',
                error: new Error('Root element not found'),
              }, '*');
            }
            const screenshot = await htmlToImage.toPng(rootElement, {
              imagePlaceholder:
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjePDgwX8ACOQDoNsk0PMAAAAASUVORK5CYII=",
            });
            window.parent.postMessage({
              type: 'screenshotData',
              data: screenshot,
            }, '*');
          } else if (event.data.type === 'claudeComplete') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.completion);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'proxyFetchResponse') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
              callbacksMap.delete(event.data.id);
            } else {
              // Initial response with headers, status, etc.
              callback.resolve({
                status: event.data.status,
                statusText: event.data.statusText,
                headers: event.data.headers
              });
              // Don't delete the callback yet if streaming
              if (!event.data.body) {
                callbacksMap.delete(event.data.id);
              }
            }
          } else if (event.data.type === 'proxyFetchStream') {
            // Handle streaming data chunks
            const controller = streamControllers.get(event.data.channelId);
            if (controller) {
              if (event.data.error) {
                controller.error(new Error(event.data.error));
                streamControllers.delete(event.data.channelId);
              } else if (event.data.done) {
                controller.close();
                streamControllers.delete(event.data.channelId);
                // Clean up the callback
                const callback = Array.from(callbacksMap.entries()).find(
                  ([_, value]) => value.channelId === event.data.channelId
                );
                if (callback) {
                  callbacksMap.delete(callback[0]);
                }
              } else if (event.data.chunk) {
                controller.enqueue(new Uint8Array(event.data.chunk));
              }
            }
          } else if (event.data.type === 'storageGet') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageSet') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageDelete') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          } else if (event.data.type === 'storageList') {
            const callback = callbacksMap.get(event.data.id);
            if (event.data.error) {
              callback.reject(new Error(event.data.error));
            } else {
              callback.resolve(event.data.result);
            }
            callbacksMap.delete(event.data.id);
          }
        });

        window.addEventListener('click', (event) => {
          const isEl = event.target instanceof HTMLElement;
          if (!isEl) return;
    
          // find ancestor links
          const linkEl = event.target.closest("a");
          if (!linkEl || !linkEl.href) return;
    
          event.preventDefault();
          event.stopImmediatePropagation();
    
          if (linkEl.href.startsWith("blob-request:")) {
            const blob = getBlobFromURL(linkEl.href);
            if (!blob) return;
            void blob.arrayBuffer().then((data) => {
              window.parent.postMessage({
                type: "downloadFile",
                filename: linkEl.download,
                data,
                mimeType: blob.type || "application/octet-stream",
              });
            });
          } else if (linkEl.href.startsWith("data:")) {
            const [header, base64Data] = linkEl.href.split(",");
            const mimeMatch = header.match(/data:([^;]+)/);
            const mimeType = mimeMatch ? mimeMatch[1] : "application/octet-stream";
            const binaryString = atob(base64Data);
            const data = Uint8Array.from(binaryString, (c) =>
              c.charCodeAt(0),
            ).buffer;
            window.parent.postMessage({
              type: "downloadFile",
              filename: linkEl.download,
              data,
              mimeType,
            });
          } else {
            let linkUrl;
            try {
              linkUrl = new URL(linkEl.href);
            } catch (error) {
              return;
            }
    
            if (linkUrl.hostname === window.location.hostname) return;
      
            window.parent.postMessage({
              type: 'openExternal',
              href: linkEl.href,
            }, '*');
          }
      });

        const originalOpen = window.open;
        window.open = function (url) {
          window.parent.postMessage({
            type: "openExternal",
            href: url,
          }, "*");
        };

        window.addEventListener('error', (event) => {
          window.parent.postMessage({ type: 'console', message: 'Uncaught Error: ' + event.message }, '*');
        });
      })();
    </script>
  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CircuitLab - Simulador de Circuitos</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #0c1445, #1a2980, #26d0ce); color: #fff; min-height: 100vh; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 2.5em; color: #00ffff; text-shadow: 0 0 20px #00ffff; margin-bottom: 10px; }
        .circuits-vertical { display: flex; flex-direction: column; gap: 50px; max-width: 900px; margin: 0 auto; }
        .circuit-card { background: rgba(255, 255, 255, 0.05); border: 3px solid #00ffff; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .circuit-title { text-align: center; font-size: 1.8em; color: #ffff00; margin-bottom: 25px; text-shadow: 0 0 15px #ffff00; }
        .series-display { width: 100%; max-width: 600px; height: 320px; background: linear-gradient(135deg, #e3f2fd, #90caf9); border: 3px solid #1976d2; border-radius: 15px; position: relative; margin: 0 auto 25px; }
        .parallel-display { width: 100%; max-width: 600px; height: 320px; background: linear-gradient(135deg, #f3e5f5, #ce93d8); border: 3px solid #7b1fa2; border-radius: 15px; position: relative; margin: 0 auto 25px; }
        .wire { position: absolute; background: #333; z-index: 1; }
        .component { position: absolute; cursor: pointer; z-index: 2; transition: all 0.3s ease; }
        .bulb { width: 45px; height: 45px; background: radial-gradient(circle, #fff9c4, #ffd700); border: 3px solid #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .bulb.on { background: radial-gradient(circle, #ffff00, #ff6600); box-shadow: 0 0 25px #ffff00; animation: glow 1s ease-in-out infinite alternate; }
        .bulb.broken { background: radial-gradient(circle, #666, #333); border-color: #ff0000; }
        .bulb.broken::after { content: '‚ùå'; position: absolute; font-size: 18px; color: #ff0000; }
        @keyframes glow { from { box-shadow: 0 0 25px #ffff00; } to { box-shadow: 0 0 45px #ffff00, 0 0 65px #ffa500; } }
        .battery { width: 55px; height: 40px; background: #ffffff; border: 3px solid #333; border-radius: 5px; position: relative; }
        .battery.disconnected { background: #cccccc; }
        .switch { width: 50px; height: 30px; background: #f0f0f0; border: 3px solid #333; border-radius: 8px; position: relative; }
        .switch.closed { background: #e8f5e8; }
        .controls { display: flex; justify-content: center; gap: 12px; margin: 20px 0; flex-wrap: wrap; }
        .control-btn { padding: 10px 18px; background: linear-gradient(45deg, #00ffff, #0066ff); border: none; border-radius: 20px; color: white; font-weight: bold; cursor: pointer; font-size: 14px; transition: all 0.3s ease; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2); }
        .control-btn:hover { transform: translateY(-2px); }
        .info-display { background: rgba(0,0,0,0.4); border-radius: 10px; padding: 15px; text-align: center; color: #fff; font-size: 16px; }
        .current-particle { position: absolute; width: 8px; height: 8px; background: #00ff00; border-radius: 50%; box-shadow: 0 0 12px #00ff00; z-index: 10; transition: all 0.8s linear; }
        .particle-orange { background: #ff6600; box-shadow: 0 0 12px #ff6600; }
    </style>
</head>
<body id="artifacts-component-root-html">
    <div class="container">
        <header class="header">
            <h1>CircuitLab</h1>
            <p>Simulador Interactivo de Circuitos El√©ctricos</p>
            <div style="margin-top: 20px;">
                <button class="control-btn" onclick="showSection('theory')" id="btn-theory">üìö Teor√≠a</button>
                <button class="control-btn" onclick="showSection('simulator')" id="btn-simulator">üî¨ Simulador</button>
                <button class="control-btn" onclick="showSection('quiz')" id="btn-quiz">üìù Evaluaci√≥n</button>
                <button class="control-btn" onclick="downloadCircuitLab()" style="background: linear-gradient(45deg, #4caf50, #2e7d32);">üíæ Descargar</button>
            </div>
            <div id="progress-indicator" style="margin-top: 15px; text-align: center; color: #00ffff;">
                <span id="section-status">Secci√≥n: Teor√≠a | Progreso: 33%</span>
            </div>
        </header>

        <div id="theory-section" style="display: block;">
            <!-- Introducci√≥n a Circuitos El√©ctricos -->
            <div class="circuit-card">
                <h2 class="circuit-title">üî¨ Fundamentos de Circuitos El√©ctricos</h2>
                <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                    <h3 style="color: #00ffff; margin-bottom: 20px;">¬øQu√© es un Circuito El√©ctrico?</h3>
                    <p style="line-height: 1.8; margin-bottom: 20px; font-size: 16px;">
                        Un circuito el√©ctrico es un <strong>camino cerrado</strong> por el cual fluye la corriente el√©ctrica. 
                        Imag√≠nalo como un sistema de carreteras donde los electrones viajan desde la fuente de energ√≠a, 
                        pasan por diferentes componentes y regresan al punto de partida.
                    </p>
                    <div style="background: rgba(0,255,255,0.1); padding: 20px; border-radius: 10px; border-left: 4px solid #00ffff;">
                        <h4 style="color: #ffff00; margin-bottom: 15px;">üîç Conceptos Clave:</h4>
                        <ul style="line-height: 1.6; font-size: 15px;">
                            <li><strong>Corriente el√©ctrica:</strong> Flujo de electrones a trav√©s de un conductor</li>
                            <li><strong>Voltaje:</strong> La "presi√≥n" que empuja a los electrones</li>
                            <li><strong>Conductor:</strong> Material que permite el paso de la electricidad</li>
                            <li><strong>Circuito cerrado:</strong> Camino completo para el flujo de corriente</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Componentes del Circuito -->
            <div class="circuit-card">
                <h2 class="circuit-title">‚öôÔ∏è Componentes Principales</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
                    <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; border: 2px solid #00ffff;">
                        <h4 style="color: #00ffff; margin-bottom: 15px;">üîã Fuente de Energ√≠a (Bater√≠a)</h4>
                        <p style="font-size: 15px; line-height: 1.6; margin-bottom: 15px;">
                            La bater√≠a es el "coraz√≥n" del circuito. Convierte energ√≠a qu√≠mica en energ√≠a el√©ctrica, 
                            creando una diferencia de potencial (voltaje) que impulsa a los electrones.
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                            <strong>Caracter√≠sticas:</strong><br>
                            ‚Ä¢ Terminal positivo (+) y negativo (-)<br>
                            ‚Ä¢ Voltaje t√≠pico: 1.5V, 9V, 12V<br>
                            ‚Ä¢ Proporciona energ√≠a constante
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; border: 2px solid #ffff00;">
                        <h4 style="color: #ffff00; margin-bottom: 15px;">üí° Carga (Bombilla)</h4>
                        <p style="font-size: 15px; line-height: 1.6; margin-bottom: 15px;">
                            La bombilla es un dispositivo que convierte energ√≠a el√©ctrica en luz y calor. 
                            Act√∫a como una resistencia que consume la energ√≠a del circuito.
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                            <strong>Funci√≥n:</strong><br>
                            ‚Ä¢ Convierte electricidad en luz<br>
                            ‚Ä¢ Tiene resistencia interna<br>
                            ‚Ä¢ Indicador visual de funcionamiento
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; border: 2px solid #ff6600;">
                        <h4 style="color: #ff6600; margin-bottom: 15px;">üîß Interruptor</h4>
                        <p style="font-size: 15px; line-height: 1.6; margin-bottom: 15px;">
                            El interruptor controla el flujo de corriente. Puede abrir o cerrar el circuito, 
                            permitiendo o impidiendo que la electricidad circule.
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                            <strong>Estados:</strong><br>
                            ‚Ä¢ Abierto: No pasa corriente<br>
                            ‚Ä¢ Cerrado: Permite el flujo<br>
                            ‚Ä¢ Control manual del circuito
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; border: 2px solid #9c27b0;">
                        <h4 style="color: #9c27b0; margin-bottom: 15px;">üîå Conductores (Cables)</h4>
                        <p style="font-size: 15px; line-height: 1.6; margin-bottom: 15px;">
                            Los cables conectan todos los componentes, proporcionando el camino por donde 
                            viajan los electrones. Generalmente est√°n hechos de cobre.
                        </p>
                        <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                            <strong>Propiedades:</strong><br>
                            ‚Ä¢ Baja resistencia<br>
                            ‚Ä¢ Material conductor (cobre)<br>
                            ‚Ä¢ Conectan los componentes
                        </div>
                    </div>
                </div>
            </div>



            <!-- Circuitos en Serie vs Paralelo -->
            <div class="circuit-card">
                <h2 class="circuit-title">üîó Circuitos en Serie vs Paralelo</h2>
                
                <!-- Circuitos en Serie -->
                <div style="background: rgba(25,118,210,0.2); padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 2px solid #1976d2;">
                    <h3 style="color: #1976d2; margin-bottom: 20px;">üîó Circuitos en Serie</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                        <div>
                            <h4 style="color: #00ffff; margin-bottom: 15px;">Caracter√≠sticas:</h4>
                            <ul style="line-height: 1.8; font-size: 15px;">
                                <li><strong>Un solo camino:</strong> La corriente tiene una sola ruta</li>
                                <li><strong>Misma corriente:</strong> Todos los componentes reciben la misma corriente</li>
                                <li><strong>Voltaje dividido:</strong> El voltaje se reparte entre componentes</li>
                                <li><strong>Dependencia total:</strong> Si falla uno, fallan todos</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #00ffff; margin-bottom: 15px;">Aplicaciones:</h4>
                            <ul style="line-height: 1.8; font-size: 15px;">
                                <li>Luces navide√±as tradicionales</li>
                                <li>Algunos interruptores de seguridad</li>
                                <li>Circuitos simples de control</li>
                            </ul>
                            <div style="background: rgba(255,0,0,0.2); padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <strong style="color: #ff6600;">‚ö†Ô∏è Desventaja:</strong> Si una bombilla se quema, todo el circuito deja de funcionar.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Circuitos en Paralelo -->
                <div style="background: rgba(123,31,162,0.2); padding: 25px; border-radius: 15px; border: 2px solid #7b1fa2;">
                    <h3 style="color: #7b1fa2; margin-bottom: 20px;">üîÄ Circuitos en Paralelo</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                        <div>
                            <h4 style="color: #00ffff; margin-bottom: 15px;">Caracter√≠sticas:</h4>
                            <ul style="line-height: 1.8; font-size: 15px;">
                                <li><strong>M√∫ltiples caminos:</strong> Varios caminos para la corriente</li>
                                <li><strong>Mismo voltaje:</strong> Todos reciben el voltaje completo</li>
                                <li><strong>Corriente dividida:</strong> Se reparte seg√∫n resistencias</li>
                                <li><strong>Independencia:</strong> Cada componente funciona solo</li>
                            </ul>
                        </div>
                        <div>
                            <h4 style="color: #00ffff; margin-bottom: 15px;">Aplicaciones:</h4>
                            <ul style="line-height: 1.8; font-size: 15px;">
                                <li>Instalaciones el√©ctricas dom√©sticas</li>
                                <li>Luces de autom√≥viles</li>
                                <li>Sistemas de iluminaci√≥n modernos</li>
                            </ul>
                            <div style="background: rgba(0,255,0,0.2); padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <strong style="color: #4caf50;">‚úÖ Ventaja:</strong> Si una bombilla falla, las dem√°s siguen funcionando.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seguridad El√©ctrica -->
            <div class="circuit-card">
                <h2 class="circuit-title">‚ö†Ô∏è Seguridad El√©ctrica</h2>
                <div style="background: rgba(255,152,0,0.2); padding: 25px; border-radius: 15px; border: 2px solid #ff9800;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                            <h4 style="color: #ff6600;">üö´ Nunca hagas:</h4>
                            <ul style="line-height: 1.6;">
                                <li>Tocar cables pelados</li>
                                <li>Trabajar con circuitos energizados</li>
                                <li>Usar equipos da√±ados</li>
                                <li>Mezclar agua y electricidad</li>
                            </ul>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px;">
                            <h4 style="color: #4caf50;">‚úÖ Siempre:</h4>
                            <ul style="line-height: 1.6;">
                                <li>Desconectar antes de trabajar</li>
                                <li>Usar herramientas aisladas</li>
                                <li>Verificar conexiones</li>
                                <li>Seguir c√≥digos el√©ctricos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="quiz-section" style="display: none;">
            <div class="circuit-card">
                <h2 class="circuit-title">üéØ Evaluaci√≥n Interactiva</h2>
                
                <!-- Selector de Nivel -->
                <div id="level-selector" style="text-align: center; margin: 30px 0;">
                    <h3 style="color: #00ffff; margin-bottom: 25px;">Selecciona tu nivel de dificultad:</h3>
                    <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                        <button class="control-btn" onclick="startLevel(1)" style="background: linear-gradient(45deg, #4caf50, #2e7d32); padding: 15px 25px;">
                            üü¢ B√°sico<br><small>Conceptos fundamentales</small>
                        </button>
                        <button class="control-btn" onclick="startLevel(2)" style="background: linear-gradient(45deg, #ff9800, #ef6c00); padding: 15px 25px;">
                            üü° Intermedio<br><small>Aplicaciones pr√°cticas</small>
                        </button>
                        <button class="control-btn" onclick="startLevel(3)" style="background: linear-gradient(45deg, #f44336, #c62828); padding: 15px 25px;">
                            üî¥ Avanzado<br><small>Aplicaciones y circuitos mixtos</small>
                        </button>
                    </div>
                    <div style="margin-top: 20px; color: #fff; opacity: 0.8;">
                        <p>üí° <strong>Tip:</strong> Cada nivel incluye opci√≥n m√∫ltiple y verdadero/falso</p>
                    </div>
                </div>

                <!-- Progreso del Quiz -->
                <div id="quiz-progress" style="display: none; margin-bottom: 25px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <span style="color: #00ffff; font-weight: bold;">Nivel: <span id="current-level">B√°sico</span></span>
                            <button class="control-btn" onclick="resetQuiz()" style="background: linear-gradient(45deg, #f44336, #c62828); padding: 8px 16px; font-size: 12px;">üîÑ Reset</button>
                            <span style="color: #ffff00;">Pregunta <span id="question-number">1</span> de <span id="total-questions">8</span></span>
                        </div>
                        <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="progress-bar" style="background: linear-gradient(45deg, #00ffff, #0066ff); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="text-align: center; margin-top: 10px;">
                            <span style="color: #4caf50;">‚úÖ Correctas: <span id="correct-count">0</span></span>
                            <span style="margin: 0 20px;">|</span>
                            <span style="color: #f44336;">‚ùå Incorrectas: <span id="incorrect-count">0</span></span>
                        </div>
                    </div>
                </div>

                <!-- Contenedor de Preguntas -->
                <div id="quiz-container" style="display: none;">
                    <div id="question-container"></div>
                    <div id="feedback-container" style="display: none; margin-top: 25px;"></div>
                    <div style="display: flex; justify-content: center; margin-top: 30px;">
                        <button class="control-btn" onclick="nextQuestion()" id="next-btn" style="display: none;">
                            Siguiente Pregunta ‚Üí
                        </button>
                    </div>
                </div>

                <!-- Resultados Finales -->
                <div id="quiz-results" style="display: none; text-align: center; padding: 30px;">
                    <div id="final-results"></div>
                    <div style="margin-top: 30px;">
                        <button class="control-btn" onclick="showLevelSelector()" style="margin-right: 10px;">üîÑ Cambiar Nivel</button>
                        <button class="control-btn" onclick="restartCurrentLevel()" style="margin-right: 10px;">üîÅ Repetir Nivel</button>
                        <button class="control-btn" onclick="resetQuiz()" style="background: linear-gradient(45deg, #f44336, #c62828);">üè† Volver al Inicio</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="circuits-vertical" id="simulator-section" style="display: none;">
            <div class="circuit-card">
                <h2 class="circuit-title">Circuito en Serie</h2>
                <div class="series-display" id="series-circuit">
                    <div class="wire" style="top: 130px; left: 70px; width: 380px; height: 4px;"></div>
                    <div class="wire" style="top: 134px; left: 450px; width: 4px; height: 80px;"></div>
                    <div class="wire" style="top: 210px; left: 70px; width: 380px; height: 4px;"></div>
                    <div class="wire" style="top: 134px; left: 70px; width: 4px; height: 80px;"></div>
                    <div class="component bulb" id="bulb1-s" style="top: 105px; left: 170px;">üí°</div>
                    <div class="component bulb" id="bulb2-s" style="top: 105px; left: 290px;">üí°</div>
                    <div class="component battery" id="battery-s" style="top: 160px; left: 425px; transform: rotate(-90deg);">
                        <div style="position: absolute; left: 50%; top: 10px; transform: translateX(-50%); font-size: 14px; color: red;">+</div>
                        <div style="position: absolute; left: 50%; bottom: 10px; transform: translateX(-50%); font-size: 14px;">‚àí</div>
                    </div>
                    <div class="component switch" id="switch-s" style="top: 150px; left: 45px; transform: rotate(-90deg);">
                        <div id="lever-s" style="position: absolute; left: 12px; bottom: 13px; width: 18px; height: 3px; background: #333; transform: rotate(25deg); transform-origin: left;"></div>
                    </div>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="toggleSwitch('s')">üîß Interruptor</button>
                    <button class="control-btn" onclick="toggleBulb('bulb1-s')">üí° Bombilla 1</button>
                    <button class="control-btn" onclick="toggleBulb('bulb2-s')">üí° Bombilla 2</button>
                    <button class="control-btn" onclick="resetCircuit('s')">üîÑ Reset</button>
                </div>
                <div class="info-display">
                    <strong>Estado:</strong> <span id="status-s">Circuito Abierto</span><br>
                    <strong>Corriente:</strong> <span id="current-s">0 A</span> | <strong>Voltaje:</strong> <span id="voltage-s">0 V</span>
                </div>
            </div>

            <div class="circuit-card">
                <h2 class="circuit-title">Circuito en Paralelo</h2>
                <div class="parallel-display" id="parallel-circuit">
                    <div class="wire" style="top: 120px; left: 100px; width: 4px; height: 110px;"></div>
                    <div class="wire" style="top: 120px; left: 400px; width: 4px; height: 110px;"></div>
                    <div class="wire" style="top: 226px; left: 104px; width: 296px; height: 4px;"></div>
                    <div class="wire" style="top: 120px; left: 104px; width: 296px; height: 4px;"></div>
                    <div class="wire" style="top: 160px; left: 104px; width: 296px; height: 4px;"></div>
                    <div class="component bulb" id="bulb1-p" style="top: 95px; left: 275px;">üí°</div>
                    <div class="component bulb" id="bulb2-p" style="top: 135px; left: 275px;">üí°</div>
                    <div class="component battery" id="battery-p" style="top: 206px; left: 330px;">
                        <div style="position: absolute; left: 10px; top: 50%; transform: translateY(-50%); font-size: 14px; color: red;">+</div>
                        <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 14px;">‚àí</div>
                    </div>
                    <div class="component switch" id="switch-p" style="top: 175px; left: 150px;">
                        <div id="lever-p" style="position: absolute; left: 12px; bottom: 13px; width: 18px; height: 3px; background: #333; transform: rotate(25deg); transform-origin: left;"></div>
                    </div>
                </div>
                <div class="controls">
                    <button class="control-btn" onclick="toggleSwitch('p')">üîß Interruptor</button>
                    <button class="control-btn" onclick="toggleBulb('bulb1-p')">üí° Bombilla 1</button>
                    <button class="control-btn" onclick="toggleBulb('bulb2-p')">üí° Bombilla 2</button>
                    <button class="control-btn" onclick="resetCircuit('p')">üîÑ Reset</button>
                </div>
                <div class="info-display">
                    <strong>Estado:</strong> <span id="status-p">0 Bombilla(s)</span><br>
                    <strong>Corriente:</strong> <span id="current-p">0.00 A</span> | <strong>Voltaje:</strong> <span id="voltage-p">9 V</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Pie de P√°gina -->
    <footer style="background: rgba(0,0,0,0.4); margin-top: 50px; padding: 30px 0; border-top: 2px solid #00ffff;">
        <div class="container">
            <div style="text-align: center; color: #fff;">
                <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 15px; border: 1px solid rgba(0,255,255,0.3); max-width: 600px; margin: 0 auto;">
                    <h3 style="color: #00ffff; margin-bottom: 20px; font-size: 1.5em; text-shadow: 0 0 10px #00ffff;">MISI√ìN 01</h3>
                    
                    <div style="margin: 20px 0;">
                        <h4 style="color: #ffff00; font-size: 1.2em; margin-bottom: 10px;">Carlos Mario Sanjuan Amador</h4>
                    </div>
                    
                    <div style="border-top: 1px solid rgba(255,255,255,0.2); padding-top: 20px; margin-top: 20px;">
                        <h4 style="color: #00ffff; margin-bottom: 15px;">Universidad de Cartagena</h4>
                        <p style="color: #fff; font-size: 16px; margin-bottom: 10px;">Recursos Educativos Digitales</p>
                        <p style="color: #ffff00; font-weight: bold; margin-bottom: 15px;">JUAN FRANCISCO GONZALEZ BRITO</p>
                        <p style="color: #ccc; font-size: 14px;">Septiembre 2025</p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Variables globales
        var circuits = {
            s: {battery: true, switch: false, bulb1: true, bulb2: true, working: false},
            p: {battery: true, switch: false, bulb1: true, bulb2: true, working: false}
        };
        var currentQuestion = 0, score = 0, incorrectAnswers = 0, currentLevel = 1, levelQuestions = [];

        // Banco de preguntas organizadas por nivel (sin Ley de Ohm)
        var questionBank = {
            1: { // Nivel B√°sico
                multiple: [
                    {
                        question: "¬øQu√© es un circuito el√©ctrico?",
                        options: ["Un dispositivo electr√≥nico", "Un camino cerrado para la corriente el√©ctrica", "Una bater√≠a grande", "Una herramienta"],
                        correct: 1,
                        explanation: "Un circuito el√©ctrico es un camino cerrado que permite el flujo de corriente el√©ctrica desde la fuente de energ√≠a, a trav√©s de los componentes, y de regreso a la fuente."
                    },
                    {
                        question: "¬øCu√°l es la funci√≥n principal de una bater√≠a?",
                        options: ["Consumir energ√≠a", "Producir luz", "Proporcionar energ√≠a el√©ctrica", "Resistir la corriente"],
                        correct: 2,
                        explanation: "La bater√≠a convierte energ√≠a qu√≠mica en energ√≠a el√©ctrica, proporcionando el voltaje necesario para que fluya la corriente en el circuito."
                    },
                    {
                        question: "¬øQu√© componente controla el paso de la corriente?",
                        options: ["La bombilla", "El interruptor", "La bater√≠a", "Los cables"],
                        correct: 1,
                        explanation: "El interruptor puede abrir o cerrar el circuito, controlando si la corriente puede fluir o no."
                    },
                    {
                        question: "¬øQu√© material se usa com√∫nmente en los cables conductores?",
                        options: ["Pl√°stico", "Cobre", "Madera", "Vidrio"],
                        correct: 1,
                        explanation: "El cobre es un excelente conductor el√©ctrico, por eso se usa en la mayor√≠a de cables el√©ctricos."
                    }
                ],
                trueFalse: [
                    {
                        question: "En un circuito cerrado, la corriente puede fluir libremente.",
                        answer: true,
                        explanation: "VERDADERO: Un circuito cerrado proporciona un camino completo para que fluya la corriente el√©ctrica."
                    },
                    {
                        question: "Los cables de cobre son buenos aislantes.",
                        answer: false,
                        explanation: "FALSO: El cobre es un excelente conductor, no un aislante. Los buenos conductores permiten el f√°cil paso de la electricidad."
                    },
                    {
                        question: "Una bombilla convierte energ√≠a el√©ctrica en luz y calor.",
                        answer: true,
                        explanation: "VERDADERO: Las bombillas transforman la energ√≠a el√©ctrica en energ√≠a luminosa y t√©rmica (calor)."
                    }
                ]
            },
            2: { // Nivel Intermedio  
                multiple: [
                    {
                        question: "En un circuito en serie, si una bombilla falla:",
                        options: ["Solo esa bombilla se apaga", "Las otras brillan m√°s", "Todas las bombillas se apagan", "No pasa nada"],
                        correct: 2,
                        explanation: "En serie hay un solo camino para la corriente. Si un componente falla, se rompe el circuito completo y todos los componentes dejan de funcionar."
                    },
                    {
                        question: "¬øCu√°l es la principal ventaja del circuito en paralelo?",
                        options: ["Consume menos energ√≠a", "Es m√°s barato de instalar", "Cada componente funciona independientemente", "Necesita menos cables"],
                        correct: 2,
                        explanation: "En paralelo, cada componente tiene su propio camino hacia la fuente. Si uno falla, los dem√°s siguen funcionando normalmente."
                    },
                    {
                        question: "En un circuito en paralelo, todos los componentes reciben:",
                        options: ["La misma corriente", "El mismo voltaje", "La misma potencia", "El mismo brillo"],
                        correct: 1,
                        explanation: "En paralelo, todos los componentes est√°n conectados directamente a la fuente, por lo que reciben el mismo voltaje."
                    },
                    {
                        question: "¬øD√≥nde se usan principalmente los circuitos en serie?",
                        options: ["Casas modernas", "Luces navide√±as", "Autom√≥viles", "Computadoras"],
                        correct: 1,
                        explanation: "Las luces navide√±as tradicionales usan circuitos en serie, por eso si se quema una, se apagan todas."
                    }
                ],
                trueFalse: [
                    {
                        question: "Las luces de una casa est√°n conectadas en serie.",
                        answer: false,
                        explanation: "FALSO: Las luces dom√©sticas est√°n en paralelo para que puedan funcionar independientemente. Si estuvieran en serie, al apagar una se apagar√≠an todas."
                    },
                    {
                        question: "En un circuito en serie, la corriente es la misma en todos los puntos.",
                        answer: true,
                        explanation: "VERDADERO: Como hay un solo camino, la misma corriente fluye por todos los componentes en serie."
                    },
                    {
                        question: "Los interruptores siempre deben estar en paralelo con las bombillas.",
                        answer: false,
                        explanation: "FALSO: Los interruptores se conectan en serie con las cargas que controlan, para poder interrumpir el flujo de corriente hacia ellas."
                    },
                    {
                        question: "En paralelo, si desconecto una bombilla, las otras siguen funcionando.",
                        answer: true,
                        explanation: "VERDADERO: Cada bombilla en paralelo tiene su propio camino independiente hacia la fuente de energ√≠a."
                    }
                ]
            },
            3: { // Nivel Avanzado (sin c√°lculos)
                multiple: [
                    {
                        question: "¬øQu√© tipo de circuito se usa en las instalaciones el√©ctricas dom√©sticas?",
                        options: ["Solo serie", "Solo paralelo", "Combinaci√≥n de serie y paralelo", "Ninguno de los anteriores"],
                        correct: 2,
                        explanation: "Las casas usan una combinaci√≥n: paralelo para los tomacorrientes y luces, pero los interruptores van en serie con las cargas que controlan."
                    },
                    {
                        question: "¬øPor qu√© las luces de un autom√≥vil est√°n en paralelo?",
                        options: ["Para ahorrar bater√≠a", "Para que funcionen independientemente", "Para que brillen m√°s", "Para facilitar el mantenimiento"],
                        correct: 1,
                        explanation: "Si las luces del auto estuvieran en serie y una falla, todas se apagar√≠an, lo cual ser√≠a muy peligroso para la seguridad vial."
                    },
                    {
                        question: "En un circuito mixto (serie-paralelo), ¬øqu√© pasa si falla el componente en serie?",
                        options: ["Solo √©l se apaga", "Solo los de paralelo fallan", "Todo el circuito falla", "Nada cambia"],
                        correct: 2,
                        explanation: "El componente en serie controla todo el circuito. Si falla, interrumpe el flujo para toda la red, incluyendo las ramas en paralelo."
                    }
                ],
                trueFalse: [
                    {
                        question: "Los circuitos en serie son m√°s seguros que los de paralelo.",
                        answer: false,
                        explanation: "FALSO: Los circuitos en paralelo son generalmente m√°s seguros porque si falla un componente, los dem√°s siguen funcionando."
                    },
                    {
                        question: "En un circuito paralelo, cada rama recibe el voltaje completo de la fuente.",
                        answer: true,
                        explanation: "VERDADERO: Cada rama en paralelo est√° conectada directamente a los terminales de la fuente, recibiendo el voltaje completo."
                    },
                    {
                        question: "Es posible combinar circuitos en serie y paralelo en un mismo sistema.",
                        answer: true,
                        explanation: "VERDADERO: Los circuitos mixtos combinan ambos tipos. Por ejemplo, un interruptor en serie controla varias luces conectadas en paralelo."
                    }
                ]
            }
        };

        // Funciones de navegaci√≥n
        function showSection(s) {
            var sim = document.getElementById('simulator-section'),
                th = document.getElementById('theory-section'),
                qu = document.getElementById('quiz-section'),
                bS = document.getElementById('btn-simulator'),
                bT = document.getElementById('btn-theory'),
                bQ = document.getElementById('btn-quiz');
            
            if(sim) sim.style.display = 'none';
            if(th) th.style.display = 'none';
            if(qu) qu.style.display = 'none';
            
            if(bS) bS.style.background = 'linear-gradient(45deg,#00ffff,#0066ff)';
            if(bT) bT.style.background = 'linear-gradient(45deg,#00ffff,#0066ff)';
            if(bQ) bQ.style.background = 'linear-gradient(45deg,#00ffff,#0066ff)';
            
            if(s === 'simulator') {
                if(sim) sim.style.display = 'flex';
                if(bS) bS.style.background = 'linear-gradient(45deg,#ffff00,#ff6600)';
                updateSectionStatus('Simulador', 66);
            } else if(s === 'quiz') {
                if(qu) qu.style.display = 'block';
                if(bQ) bQ.style.background = 'linear-gradient(45deg,#ffff00,#ff6600)';
                updateSectionStatus('Evaluaci√≥n', 100);
                showLevelSelector();
            } else {
                if(th) th.style.display = 'block';
                if(bT) bT.style.background = 'linear-gradient(45deg,#ffff00,#ff6600)';
                updateSectionStatus('Teor√≠a', 33);
            }
        }

        function updateSectionStatus(n, p) {
            var e = document.getElementById('section-status');
            if(e) e.textContent = 'Secci√≥n: ' + n + ' | Progreso: ' + p + '%';
        }

        // Funciones del quiz
        function showLevelSelector() {
            document.getElementById('level-selector').style.display = 'block';
            document.getElementById('quiz-progress').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'none';
        }

        function startLevel(level) {
            currentLevel = level;
            currentQuestion = 0;
            score = 0;
            incorrectAnswers = 0;
            
            // Mezclar preguntas del nivel
            levelQuestions = [];
            var bank = questionBank[level];
            if(bank.multiple) levelQuestions = levelQuestions.concat(bank.multiple);
            if(bank.trueFalse) levelQuestions = levelQuestions.concat(bank.trueFalse);
            if(bank.problems) levelQuestions = levelQuestions.concat(bank.problems);
            
            // Mezclar array
            for(let i = levelQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [levelQuestions[i], levelQuestions[j]] = [levelQuestions[j], levelQuestions[i]];
            }
            
            document.getElementById('level-selector').style.display = 'none';
            document.getElementById('quiz-progress').style.display = 'block';
            document.getElementById('quiz-container').style.display = 'block';
            
            var levelNames = {1:'B√°sico üü¢', 2:'Intermedio üü°', 3:'Avanzado üî¥'};
            document.getElementById('current-level').textContent = levelNames[level];
            document.getElementById('total-questions').textContent = levelQuestions.length;
            
            loadQuestion();
        }

        function loadQuestion() {
            if(currentQuestion >= levelQuestions.length) {
                showResults();
                return;
            }
            
            var q = levelQuestions[currentQuestion];
            var container = document.getElementById('question-container');
            var feedbackContainer = document.getElementById('feedback-container');
            
            document.getElementById('question-number').textContent = currentQuestion + 1;
            var progress = ((currentQuestion) / levelQuestions.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            
            feedbackContainer.style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            
            var questionType = q.answer !== undefined ? 'trueFalse' : (q.calculation ? 'problem' : 'multiple');
            var html = '<div style="background:rgba(0,0,0,0.3);padding:25px;border-radius:15px;">';
            
            if(questionType === 'problem') {
                html += '<div style="background:linear-gradient(45deg,#f44336,#c62828);padding:10px;border-radius:8px;margin-bottom:20px;text-align:center;"><strong>üßÆ PROBLEMA</strong></div>';
            } else if(questionType === 'trueFalse') {
                html += '<div style="background:linear-gradient(45deg,#2196f3,#1565c0);padding:10px;border-radius:8px;margin-bottom:20px;text-align:center;"><strong>‚úì‚úó VERDADERO/FALSO</strong></div>';
            } else {
                html += '<div style="background:linear-gradient(45deg,#4caf50,#2e7d32);padding:10px;border-radius:8px;margin-bottom:20px;text-align:center;"><strong>üéØ OPCI√ìN M√öLTIPLE</strong></div>';
            }
            
            html += '<h3 style="color:#ffffff;margin-bottom:25px;line-height:1.4;text-shadow:2px 2px 4px rgba(0,0,0,0.8);font-weight:bold;">' + q.question + '</h3>';
            
            if(questionType === 'trueFalse') {
                html += '<div style="display:flex;gap:15px;justify-content:center;">';
                html += '<button onclick="selectAnswer(0)" class="control-btn" style="padding:15px 30px;background:linear-gradient(45deg,#4caf50,#2e7d32);color:#ffffff;font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.7);">‚úÖ VERDADERO</button>';
                html += '<button onclick="selectAnswer(1)" class="control-btn" style="padding:15px 30px;background:linear-gradient(45deg,#f44336,#c62828);color:#ffffff;font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.7);">‚ùå FALSO</button>';
                html += '</div>';
            } else {
                for(var i = 0; i < q.options.length; i++) {
                    var bgColor = questionType === 'problem' ? 'linear-gradient(45deg,#ff9800,#ef6c00)' : 'linear-gradient(45deg,#00ffff,#0066ff)';
                    html += '<button onclick="selectAnswer(' + i + ')" class="control-btn" style="display:block;width:100%;margin:10px 0;padding:15px;background:' + bgColor + ';text-align:left;color:#ffffff;font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.7);border:2px solid rgba(255,255,255,0.3);">';
                    html += String.fromCharCode(65 + i) + '. ' + q.options[i] + '</button>';
                }
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function selectAnswer(selectedIndex) {
            var q = levelQuestions[currentQuestion];
            var isCorrect = false;
            
            if(q.answer !== undefined) { // Verdadero/Falso
                isCorrect = (selectedIndex === 0 && q.answer) || (selectedIndex === 1 && !q.answer);
            } else { // Opci√≥n m√∫ltiple o problema
                isCorrect = selectedIndex === q.correct;
            }
            
            if(isCorrect) {
                score++;
                document.getElementById('correct-count').textContent = score;
                // Mostrar mensaje emergente de √©xito
                showSuccessPopup();
                // Pasar autom√°ticamente a la siguiente pregunta despu√©s de 1.5 segundos
                setTimeout(function() {
                    currentQuestion++;
                    loadQuestion();
                }, 1500);
            } else {
                incorrectAnswers++;
                document.getElementById('incorrect-count').textContent = incorrectAnswers;
                // Para respuestas incorrectas, mostrar explicaci√≥n completa
                showFeedback(isCorrect, q, selectedIndex);
            }
        }

        function showSuccessPopup() {
            // Crear overlay
            var overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 1000;
                display: flex;
                justify-content: center;
                align-items: center;
            `;
            
            // Crear popup
            var popup = document.createElement('div');
            popup.style.cssText = `
                background: linear-gradient(45deg, #4caf50, #2e7d32);
                color: white;
                padding: 40px;
                border-radius: 20px;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                border: 3px solid #fff;
                animation: popupScale 0.3s ease-out;
            `;
            
            popup.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px;">üéâ</div>
                <h2 style="margin: 0; font-size: 24px; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">¬°CORRECTO!</h2>
            `;
            
            // Agregar animaci√≥n CSS
            if (!document.getElementById('popup-styles')) {
                var style = document.createElement('style');
                style.id = 'popup-styles';
                style.textContent = `
                    @keyframes popupScale {
                        0% { transform: scale(0.5); opacity: 0; }
                        100% { transform: scale(1); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            overlay.appendChild(popup);
            document.body.appendChild(overlay);
            
            // Remover despu√©s de 1.2 segundos
            setTimeout(function() {
                document.body.removeChild(overlay);
            }, 1200);
            
            // Deshabilitar botones de respuesta
            var buttons = document.querySelectorAll('#question-container button');
            buttons.forEach(btn => btn.disabled = true);
        }

        function showFeedback(isCorrect, question, selectedIndex) {
            var container = document.getElementById('feedback-container');
            var html = '<div style="background:rgba(0,0,0,0.4);padding:25px;border-radius:15px;border:3px solid ';
            
            if(isCorrect) {
                html += '#4caf50;"><div style="text-align:center;margin-bottom:20px;"><h3 style="color:#4caf50;font-size:24px;">üéâ ¬°CORRECTO!</h3></div>';
            } else {
                html += '#f44336;"><div style="text-align:center;margin-bottom:20px;"><h3 style="color:#f44336;font-size:24px;">‚ùå Incorrecto</h3></div>';
            }
            
            html += '<div style="background:rgba(255,255,255,0.1);padding:20px;border-radius:10px;margin-bottom:15px;">';
            html += '<h4 style="color:#00ffff;margin-bottom:10px;">üí° Explicaci√≥n:</h4>';
            html += '<p style="line-height:1.6;color:#fff;">' + question.explanation + '</p>';
            
            if(question.calculation) {
                html += '<div style="background:rgba(0,0,0,0.3);padding:15px;border-radius:8px;margin-top:15px;font-family:monospace;">';
                html += '<h5 style="color:#ffff00;margin-bottom:10px;">üßÆ C√°lculo:</h5>';
                html += '<pre style="color:#fff;margin:0;white-space:pre-wrap;">' + question.calculation + '</pre>';
                html += '</div>';
            }
            
            html += '</div></div>';
            
            container.innerHTML = html;
            container.style.display = 'block';
            document.getElementById('next-btn').style.display = 'block';
            
            // Deshabilitar botones de respuesta
            var buttons = document.querySelectorAll('#question-container button');
            buttons.forEach(btn => btn.disabled = true);
        }

        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        function showResults() {
            document.getElementById('quiz-progress').style.display = 'none';
            document.getElementById('quiz-container').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'block';
            
            var percentage = Math.round((score / levelQuestions.length) * 100);
            var levelNames = {1:'B√°sico', 2:'Intermedio', 3:'Avanzado'};
            
            var html = '<div style="background:rgba(0,0,0,0.3);padding:30px;border-radius:15px;">';
            html += '<h3 style="color:#00ffff;margin-bottom:25px;">üìä Resultados del Nivel ' + levelNames[currentLevel] + '</h3>';
            
            var resultColor = percentage >= 80 ? '#4caf50' : percentage >= 60 ? '#ff9800' : '#f44336';
            var resultIcon = percentage >= 80 ? 'üèÜ' : percentage >= 60 ? 'üëç' : 'üìö';
            var resultText = percentage >= 80 ? '¬°Excelente!' : percentage >= 60 ? '¬°Bien hecho!' : '¬°Sigue practicando!';
            
            html += '<div style="text-align:center;margin:25px 0;">';
            html += '<div style="font-size:48px;color:' + resultColor + ';margin-bottom:15px;">' + resultIcon + '</div>';
            html += '<div style="font-size:36px;color:' + resultColor + ';margin-bottom:10px;">' + score + '/' + levelQuestions.length + '</div>';
            html += '<div style="font-size:24px;color:' + resultColor + ';">' + percentage + '%</div>';
            html += '<div style="color:#fff;margin-top:15px;font-size:18px;">' + resultText + '</div>';
            html += '</div>';
            
            if(percentage >= 80) {
                if(currentLevel < 3) {
                    html += '<div style="background:rgba(76,175,80,0.2);padding:20px;border-radius:10px;margin:20px 0;border:2px solid #4caf50;">';
                    html += '<h4 style="color:#4caf50;">üöÄ ¬°Listo para el siguiente nivel!</h4>';
                    html += '<p>Has dominado este nivel. ¬øTe animas con el nivel ' + (currentLevel + 1) + '?</p>';
                    html += '<button class="control-btn" onclick="startLevel(' + (currentLevel + 1) + ')" style="background:linear-gradient(45deg,#4caf50,#2e7d32);margin-top:10px;">Nivel ' + (currentLevel + 1) + ' ‚Üí</button>';
                    html += '</div>';
                } else {
                    html += '<div style="background:rgba(255,215,0,0.2);padding:20px;border-radius:10px;margin:20px 0;border:2px solid #ffd700;">';
                    html += '<h4 style="color:#ffd700;">üéì ¬°Felicitaciones, Experto!</h4>';
                    html += '<p>Has completado todos los niveles con excelencia. ¬°Dominas los circuitos el√©ctricos!</p>';
                    html += '</div>';
                }
            } else if(percentage >= 60) {
                html += '<div style="background:rgba(255,152,0,0.2);padding:20px;border-radius:10px;margin:20px 0;border:2px solid #ff9800;">';
                html += '<h4 style="color:#ff9800;">üí™ ¬°Buen trabajo!</h4>';
                html += '<p>Tienes una base s√≥lida. Repasa los conceptos y vuelve a intentar para mejorar tu puntuaci√≥n.</p>';
                html += '</div>';
            } else {
                html += '<div style="background:rgba(244,67,54,0.2);padding:20px;border-radius:10px;margin:20px 0;border:2px solid #f44336;">';
                html += '<h4 style="color:#f44336;">üìñ ¬°No te desanimes!</h4>';
                html += '<p>Revisa la teor√≠a y practica con el simulador. El aprendizaje es un proceso. ¬°T√∫ puedes!</p>';
                html += '</div>';
            }
            
            html += '</div>';
            document.getElementById('final-results').innerHTML = html;
        }

        function restartCurrentLevel() {
            startLevel(currentLevel);
        }

        function resetQuiz() {
            if(confirm('¬øEst√°s seguro de que quieres reiniciar la evaluaci√≥n? Se perder√° todo el progreso actual.')) {
                showLevelSelector();
                // Resetear contadores
                currentQuestion = 0;
                score = 0;
                incorrectAnswers = 0;
                document.getElementById('correct-count').textContent = '0';
                document.getElementById('incorrect-count').textContent = '0';
                document.getElementById('progress-bar').style.width = '0%';
            }
        }

        // Funciones del simulador - Solo interruptor y bombillas
        function toggleSwitch(t) {
            circuits[t].switch = !circuits[t].switch;
            var s = document.getElementById('switch-' + t),
                l = document.getElementById('lever-' + t);
            if(s && l) {
                if(circuits[t].switch) {
                    l.style.transform = 'rotate(0deg)';
                    s.classList.add('closed');
                } else {
                    l.style.transform = 'rotate(25deg)';
                    s.classList.remove('closed');
                }
            }
            updateCircuit(t);
        }

        function toggleBulb(i) {
            var t = i.indexOf('-s') !== -1 ? 's' : 'p',
                n = i.indexOf('1') !== -1 ? 'bulb1' : 'bulb2';
            circuits[t][n] = !circuits[t][n];
            var b = document.getElementById(i);
            if(b) {
                if(circuits[t][n]) b.classList.remove('broken');
                else b.classList.add('broken');
            }
            updateCircuit(t);
        }

        function updateCircuit(t) {
            var b1 = document.getElementById('bulb1-' + t),
                b2 = document.getElementById('bulb2-' + t),
                s = document.getElementById('status-' + t),
                c = document.getElementById('current-' + t),
                v = document.getElementById('voltage-' + t);
            
            if(b1) b1.classList.remove('on');
            if(b2) b2.classList.remove('on');
            
            // Limpiar part√≠culas existentes primero
            removeParticles(t);
            
            if(t === 's') {
                var w = circuits.s.battery && circuits.s.switch && circuits.s.bulb1 && circuits.s.bulb2;
                circuits.s.working = w;
                if(w) {
                    if(b1) b1.classList.add('on');
                    if(b2) b2.classList.add('on');
                    if(s) s.textContent = 'Funcionando';
                    if(c) c.textContent = '0.045 A';
                    if(v) v.textContent = '9 V';
                    // Iniciar flujo autom√°tico de electrones
                    createCurrentFlow(t);
                } else {
                    if(s) s.textContent = 'Circuito Abierto';
                    if(c) c.textContent = '0 A';
                    if(v) v.textContent = '0 V';
                }
            } else {
                var bc = circuits.p.battery && circuits.p.switch, wb = 0;
                if(bc) {
                    if(circuits.p.bulb1) {
                        if(b1) b1.classList.add('on');
                        wb++;
                    }
                    if(circuits.p.bulb2) {
                        if(b2) b2.classList.add('on');
                        wb++;
                    }
                }
                circuits.p.working = bc && wb > 0;
                if(s) s.textContent = wb + ' Bombilla(s)';
                if(c) c.textContent = (wb * 0.09).toFixed(2) + ' A';
                if(v) v.textContent = '9 V';
                
                if(circuits.p.working) {
                    // Iniciar flujo autom√°tico de electrones en paralelo
                    createCurrentFlow(t);
                }
            }
        }



        function createCurrentFlow(t) {
            var container = document.getElementById((t === 's' ? 'series' : 'parallel') + '-circuit');
            if(!container) return;
            
            // Detener flujo existente
            if(container.flowInterval) {
                clearInterval(container.flowInterval);
            }
            
            // Crear flujo continuo de electrones
            container.flowInterval = setInterval(function() {
                if(!circuits[t].working) {
                    clearInterval(container.flowInterval);
                    return;
                }
                
                if(t === 's') {
                    // Circuito en serie
                    createElectron(container, seriesPath);
                } else {
                    // Circuito en paralelo - crear electrones para cada rama activa
                    if(circuits.p.bulb1) {
                        createElectronParallel(container, 'branch1');
                    }
                    if(circuits.p.bulb2) {
                        createElectronParallel(container, 'branch2');
                    }
                }
            }, 800); // Crear electrones cada 800ms
        }

        function createElectronParallel(container, route) {
            var electron = document.createElement('div');
            electron.className = 'current-particle';
            container.appendChild(electron);
            
            var path = [];
            
            if(route === 'branch1') {
                // Rama 1: Bater√≠a -> izquierda -> interruptor -> esquina -> arriba -> bombilla 1 -> derecha -> abajo -> bater√≠a
                path = [
                    {x: 330, y: 226}, // Sale de bater√≠a
                    {x: 250, y: 226}, // Va hacia izquierda
                    {x: 175, y: 226}, // Pasa por interruptor
                    {x: 104, y: 226}, // Llega a esquina izquierda
                    {x: 104, y: 200}, // Sube
                    {x: 104, y: 160}, // Sube m√°s
                    {x: 104, y: 122}, // Llega a rama 1 (arriba)
                    {x: 200, y: 122}, // Va hacia bombilla 1
                    {x: 275, y: 122}, // Pasa por bombilla 1
                    {x: 350, y: 122}, // Contin√∫a hacia derecha
                    {x: 400, y: 122}, // Llega a esquina derecha arriba
                    {x: 400, y: 150}, // Baja
                    {x: 400, y: 180}, // Baja m√°s
                    {x: 400, y: 226}, // Llega a esquina derecha abajo
                    {x: 385, y: 226}  // Regresa a bater√≠a
                ];
            } else if(route === 'branch2') {
                // Rama 2: Bater√≠a -> izquierda -> interruptor -> esquina -> medio -> bombilla 2 -> derecha -> abajo -> bater√≠a
                path = [
                    {x: 330, y: 226}, // Sale de bater√≠a
                    {x: 250, y: 226}, // Va hacia izquierda
                    {x: 175, y: 226}, // Pasa por interruptor
                    {x: 104, y: 226}, // Llega a esquina izquierda
                    {x: 104, y: 200}, // Sube un poco
                    {x: 104, y: 162}, // Llega a rama 2 (medio)
                    {x: 200, y: 162}, // Va hacia bombilla 2
                    {x: 275, y: 162}, // Pasa por bombilla 2
                    {x: 350, y: 162}, // Contin√∫a hacia derecha
                    {x: 400, y: 162}, // Llega a derecha
                    {x: 400, y: 190}, // Baja hacia l√≠nea inferior
                    {x: 400, y: 226}, // Llega a esquina derecha abajo
                    {x: 385, y: 226}  // Regresa a bater√≠a
                ];
            }
            
            // Posicionar electr√≥n al inicio (SIEMPRE en la bater√≠a)
            electron.style.left = path[0].x + 'px';
            electron.style.top = path[0].y + 'px';
            electron.style.transition = 'none';
            
            var currentStep = 0;
            
            function moveElectron() {
                if(currentStep >= path.length - 1) {
                    if(electron.parentNode) {
                        electron.parentNode.removeChild(electron);
                    }
                    return;
                }
                
                currentStep++;
                var nextPos = path[currentStep];
                electron.style.transition = 'all 0.4s linear'; // M√°s r√°pido: 0.4s en lugar de 0.6s
                electron.style.left = nextPos.x + 'px';
                electron.style.top = nextPos.y + 'px';
                
                setTimeout(moveElectron, 400); // M√°s r√°pido: 400ms en lugar de 600ms
            }
            
            setTimeout(moveElectron, 50);
        }

        // Rutas predefinidas para el movimiento (actualizadas para marcos m√°s peque√±os)
        var seriesPath = [
            {x: 70, y: 132}, // Inicio (desde interruptor)
            {x: 150, y: 132}, // Hacia bombilla 1
            {x: 195, y: 132}, // Bombilla 1
            {x: 270, y: 132}, // Hacia bombilla 2
            {x: 315, y: 132}, // Bombilla 2
            {x: 450, y: 132}, // Hacia bater√≠a
            {x: 450, y: 180}, // Centro de bater√≠a
            {x: 450, y: 212}, // L√≠nea inferior
            {x: 250, y: 212}, // L√≠nea inferior izquierda
            {x: 70, y: 212}, // L√≠nea inferior completa
            {x: 70, y: 180}, // Subiendo por interruptor
            {x: 70, y: 132}  // De vuelta al inicio
        ];

        var parallelMainPath = [
            {x: 435, y: 308}, // Desde bater√≠a (terminal +)
            {x: 450, y: 308}, // L√≠nea inferior derecha
            {x: 450, y: 250}, // Subiendo por derecha
            {x: 450, y: 182}, // L√≠nea superior derecha
            {x: 150, y: 182}, // L√≠nea superior izquierda
            {x: 150, y: 250}, // Bajando por izquierda
            {x: 150, y: 308}, // L√≠nea inferior izquierda
            {x: 200, y: 308}, // Hacia interruptor
            {x: 250, y: 308}, // Despu√©s del interruptor
            {x: 380, y: 308}, // Hacia bater√≠a
            {x: 435, y: 308}  // De vuelta a bater√≠a (terminal -)
        ];

        var parallelPath1 = [
            {x: 450, y: 182}, // Desde l√≠nea superior derecha
            {x: 350, y: 182}, // Hacia bombilla 1
            {x: 325, y: 182}, // Centro de bombilla 1
            {x: 150, y: 182}  // Hacia l√≠nea superior izquierda
        ];

        var parallelPath2 = [
            {x: 450, y: 182}, // Desde l√≠nea superior derecha
            {x: 450, y: 242}, // Bajando a rama 2
            {x: 350, y: 242}, // Hacia bombilla 2
            {x: 325, y: 242}, // Centro de bombilla 2
            {x: 150, y: 242}, // Hacia izquierda
            {x: 150, y: 182}  // Subiendo a l√≠nea principal
        ];

        function createElectron(container, path) {
            var electron = document.createElement('div');
            electron.className = 'current-particle';
            electron.style.left = path[0].x + 'px';
            electron.style.top = path[0].y + 'px';
            electron.style.transition = 'none';
            container.appendChild(electron);
            
            var currentStep = 0;
            
            function moveElectron() {
                if(currentStep >= path.length - 1) {
                    // Complet√≥ el recorrido, remover
                    if(electron.parentNode) {
                        electron.parentNode.removeChild(electron);
                    }
                    return;
                }
                
                currentStep++;
                var nextPos = path[currentStep];
                electron.style.transition = 'all 0.6s linear';
                electron.style.left = nextPos.x + 'px';
                electron.style.top = nextPos.y + 'px';
                
                setTimeout(moveElectron, 600);
            }
            
            // Iniciar movimiento despu√©s de un peque√±o delay
            setTimeout(moveElectron, 50);
        }

        function removeParticles(t) {
            var container = document.getElementById((t === 's' ? 'series' : 'parallel') + '-circuit');
            if(container) {
                // Detener el flujo continuo
                if(container.flowInterval) {
                    clearInterval(container.flowInterval);
                    container.flowInterval = null;
                }
                
                // Remover todas las part√≠culas existentes
                var particles = container.querySelectorAll('.current-particle');
                for(var i = 0; i < particles.length; i++) {
                    particles[i].remove();
                }
            }
        }

        function resetCircuit(t) {
            circuits[t] = {battery: true, switch: false, bulb1: true, bulb2: true, working: false};
            
            // Resetear visuales de los componentes
            var switch_elem = document.getElementById('switch-' + t);
            var lever = document.getElementById('lever-' + t);
            var bulb1 = document.getElementById('bulb1-' + t);
            var bulb2 = document.getElementById('bulb2-' + t);
            var battery = document.getElementById('battery-' + t);
            
            if(switch_elem) switch_elem.classList.remove('closed');
            if(lever) lever.style.transform = 'rotate(25deg)';
            if(bulb1) bulb1.classList.remove('broken');
            if(bulb2) bulb2.classList.remove('broken');
            if(battery) battery.classList.remove('disconnected');
            
            updateCircuit(t);
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            updateCircuit('s');
            updateCircuit('p');
            updateSectionStatus('Teor√≠a', 33);
        });

        // Funci√≥n para descargar CircuitLab (versi√≥n mejorada para compatibilidad)
        function downloadCircuitLab() {
            try {
                // Obtener el HTML completo de la p√°gina
                var htmlContent = '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
                
                // Verificar soporte para Blob
                if (!window.Blob) {
                    fallbackDownload(htmlContent);
                    return;
                }
                
                // Crear un blob con el contenido HTML
                var blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                
                // Verificar soporte para URL.createObjectURL
                if (!window.URL || !window.URL.createObjectURL) {
                    fallbackDownload(htmlContent);
                    return;
                }
                
                var url = window.URL.createObjectURL(blob);
                
                // Crear un enlace de descarga
                var downloadLink = document.createElement('a');
                downloadLink.href = url;
                downloadLink.download = 'CircuitLab-Simulador.html';
                downloadLink.style.display = 'none';
                
                // Agregar al DOM temporalmente y hacer clic
                document.body.appendChild(downloadLink);
                downloadLink.click();
                
                // Limpiar despu√©s de un momento
                setTimeout(function() {
                    document.body.removeChild(downloadLink);
                    window.URL.revokeObjectURL(url);
                }, 100);
                
                // Mostrar mensaje de confirmaci√≥n
                setTimeout(function() {
                    alert('CircuitLab descargado exitosamente!\n\nPuedes abrir el archivo "CircuitLab-Simulador.html" en cualquier navegador para usar el simulador sin conexion a internet.');
                }, 200);
                
            } catch (error) {
                console.error('Error en descarga:', error);
                fallbackDownload(document.documentElement.outerHTML);
            }
        }

        // Funci√≥n alternativa para navegadores con limitaciones
        function fallbackDownload(content) {
            // M√©todo alternativo usando data URI
            try {
                var dataUri = 'data:text/html;charset=utf-8,' + encodeURIComponent('<!DOCTYPE html>\n' + content);
                var downloadLink = document.createElement('a');
                downloadLink.href = dataUri;
                downloadLink.download = 'CircuitLab-Simulador.html';
                downloadLink.style.display = 'none';
                
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                alert('CircuitLab descargado (modo compatibilidad)!\n\nSi no se descargo automaticamente, presiona Ctrl+S para guardar la pagina.');
                
            } catch (error) {
                // √öltimo recurso: mostrar instrucciones manuales
                alert('Descarga no disponible en este navegador.\n\nInstrucciones manuales:\n1. Presiona Ctrl+S (o Cmd+S en Mac)\n2. Guarda como "CircuitLab-Simulador.html"\n3. Selecciona "Pagina web, completa"\n4. El archivo funcionara sin internet');
            }
        }
    </script>

</body></html>